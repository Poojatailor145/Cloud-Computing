<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
        rel="stylesheet"
        href="https://cdn-uicons.flaticon.com/uicons-regular-straight/css/uicons-regular-straight.css"
    />
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <title>Coziture</title>
  </head>
  <body>
    <!--=============== HEADER ===============-->
    <header class="header">
      <nav class="nav container">
          <a href="index.html" class="nav__logo">
              <img src="images/logo.png" alt="" class="nav__logo-img">
          </a>

          <div class="nav__menu" id="nav-menu">

              <div class="nav__menu-top">
                  <a href="index.html" class="nav__menu-logo">
                      <img src="images/logo.png" alt="">
                  </a>

                  <div class="nav__close" id="nav-close">
                      <i class="fi fi-rs-cross-small"></i>
                  </div>
              </div>
              
              <ul class="nav__list">
                  <li class="nav__item">
                      <a href="index.html" class="nav__link">Home</a>
                  </li>

                  <li class="nav__item">
                      <a href="shop.html" class="nav__link active-link">Shop</a>
                  </li>

                  <li class="nav__item">
                      <a href="accounts.html" class="nav__link">My Account</a>
                  </li>
              </ul>
          </div>

          <div class="header__user-actions">
              <a href="cart.html" class="header__action-btn">
                  <img src="images/icon-cart.svg" alt="">
                  <span class="count" id="cart-count">3</span>
              </a>

              <div class="header__action-btn nav__toggle" id="nav-toggle">
                  <img src="images/menu-burger.svg" alt="">
              </div>
          </div>
      </nav>
  </header>

    <main class="main">
      <section class="breadcrumb">
        <div class="breadcrumb__list container">
            <a href="index.html" class="breadcrumb__link">Home</a>  
            <span class="breadcrumb__link">></span>  
            <span class="breadcrumb__link" id="product-name">Product Name</span>
        </div>
      </section>

      <section class="details section--lg">
        <div class="details__container container grid" id="product-details">
            <!-- Product details will be injected here dynamically -->
        </div>
      </section>

      <section class="details__tab container">
        <div class="detail__tabs">
            <span class="detail__tab active__tab">Additional Info</span>
        </div>

        <div class="details__tabs-content">
            <div class="details__tab-content active-tab" content id="info">
                <table class="info__table" id="product-table">
                    <!-- Product info will be injected here dynamically -->
                </table>
            </div>
        </div>
      </section>

      <section class="products container section--lg">
        <h3 class="section__title"><span>Related</span> Products</h3>

        <div class="products__container grid" id="related-products">
            <!-- Related products will be injected here -->
        </div>
      </section>
    </main>

    <footer class="footer container">
      <div class="footer__container grid">
          <div class="footer__content">
              <a href="index.html" class="footer__logo">
                  <img src="images/logo.png" alt="" class="footer__logo-img">
              </a>

              <h4 class="footer__subtitle">Contact</h4>
              <p class="footer__description">
                  <span>Address:</span> 562 Konrad Duden Weg, Frankfurt, Germany
              </p>

              <p class="footer__description">
                  <span>Phone:</span> 01588745454
              </p>

              <p class="footer__description">
                  <span>Working Hours:</span> 10:00 - 18:00, Mon-Sat
              </p>

              <div class="footer__social">
                  <div class="footer__subtitle">Follow Me</div>
                  <div class="footer_-social-links flex">
                      <a href="#">
                          <img src="images/icon-facebook.svg" alt="" class="footer__social-icon">
                      </a>

                      <a href="#">
                          <img src="images/icon-instagram.svg" alt="" class="footer__social-icon">
                      </a>

                      <a href="#">
                          <img src="images/icon-twitter.svg" alt="" class="footer__social-icon">
                      </a>

                      <a href="#">
                          <img src="images/icon-pinterest.svg" alt="" class="footer__social-icon">
                      </a>

                      <a href="#">
                          <img src="images/icon-youtube.svg" alt="" class="footer__social-icon">
                      </a>
                  </div>

              </div>

          </div>

          <div class="footer__content">
              <h3 class="footer__title">Address</h3>
              <ul class="footer__links">
                  <li><a href="#" class="footer__link">About Us</a></li>
                  <li><a href="#" class="footer__link">Delivery Information</a></li>
                  <li><a href="#" class="footer__link">Privacy Policy</a></li>
                  <li><a href="#" class="footer__link">Terms & Conditions</a></li>
                  <li><a href="#" class="footer__link">Contact Us</a></li>
                  <li><a href="#" class="footer__link">Support Center</a></li>
              </ul>
          </div>

          <div class="footer__content">
              <h3 class="footer__title">My Account</h3>
              <ul class="footer__links">
                  <li><a href="#" class="footer__link">Sign In</a></li>
                  <li><a href="#" class="footer__link">View cart</a></li>
                  <li><a href="#" class="footer__link">Register</a></li>
                  <li><a href="#" class="footer__link">Track My Order</a></li>
                  <li><a href="#" class="footer__link">Help</a></li>
                  <li><a href="#" class="footer__link">Order</a></li>
              </ul>
          </div>

          <div class="footer__content">
              <h3 class="footer__title">Secured Payment Gateways</h3>
              <img src="images/payment-method.png" alt="" class="payment__img">
          </div>
      </div>

      <div class="footer__bottom">
          <p class="copyright">&copy; 2025 Coziture. All Rights Reserved.</p>
      </div>
  </footer>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="js/main.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('productId');

        if (!productId) {
            alert('Product not found');
            window.location.href = 'shop.html'; 
        }

        fetch(`http://WebshopBackend-env.eba-xvipbktv.us-east-1.elasticbeanstalk.com/api/products/${productId}`)
          .then(response => response.json())
          .then(product => {
            document.getElementById('product-name').textContent = product.productName;

            const productDetailsContainer = document.getElementById('product-details');
            const alertdisplay = document.getElementById('stock-alert');
            productDetailsContainer.innerHTML = `
              <div class="details__group">
                <img src="images/${product.imageUrl}1.jpg" alt="${product.productName}" class="details__img">
                <div class="details__small-images grid">
                    <img src="images/${product.imageUrl}1.jpg" alt="" class="details__small-img">
                    <img src="images/${product.imageUrl}2.jpg" alt="" class="details__small-img">
                    <img src="images/${product.imageUrl}3.jpg" alt="" class="details__small-img">
                </div>
              </div>
              
              <div class="details__group">
                <h3 class="details__title">${product.productName}</h3>
                <p class="details__brand">Brand: <span>${product.supplierName}</span></p>
                <div class="details__price flex">
                  <span class="new__price">€${product.basePrice}</span>
                  <span class="old__price">€${(product.basePrice * 1.2).toFixed(2)}</span>
                  <span class="save__price">25% Off</span>
                </div>
                <p class="short__description">${product.description}</p>

                <ul class="product__list">
                    <li class="list__item flex"><i class="fi-rs-crown"> 1 Year ${product.supplierName} Warranty</i></li>
                    <li class="list__item flex"><i class="fi-rs-refresh"> 30 Day Return Policy</i></li>
                    <li class="list__item flex"><i class="fi-rs-credit-card"> Cash On Delivery Available</i></li>
                </ul>
                <br>

                <div class="details__action">
                  <input type="number" class="quantity" value="1" id="quantity">
                  <button class="btn btn--sm" id="add-to-cart">Add To Cart</button>
                </div>
              </div>
            `;
            const mainImg = document.querySelector('.details__img'),
            smallImgs = document.querySelectorAll('.details__small-img');

            smallImgs.forEach((img) => {
                img.addEventListener('click', function() {
                mainImg.src = this.src;  
                });
            });

            const productDetailsTable = document.getElementById('product-table');
            productDetailsTable.innerHTML = `
                    <tr><th>Weight</th><td>${product.weightKg}</td></tr>
                    <tr><th>Dimensions</th><td>${product.dimensionsCm}</td></tr>
                    <tr><th>Material</th><td>${product.materialType}</td></tr>
                    <tr><th>Stock Quantity</th><td>${product.stockQuantity}</td></tr>
            `;

            document.getElementById('add-to-cart').addEventListener('click', function() {
              addToCart(product);
            });

            // Fetch and display related products (e.g., same category)
            fetch(`http://WebshopBackend-env.eba-xvipbktv.us-east-1.elasticbeanstalk.com/api/products/category/${product.categoryId}`)
                .then(response => response.json())
                .then(relatedProducts => {
                const relatedProductsContainer = document.getElementById('related-products');
                relatedProducts.forEach(relatedProduct => {
                    const productItem = document.createElement('div');
                    productItem.classList.add('product__item');
                    productItem.innerHTML = `
                    <div class="product__banner">
                        <a href="details.html?productId=${relatedProduct.productId}" class="product__images">
                        <img src="images/${relatedProduct.imageUrl}1.jpg" alt="${relatedProduct.productName}" class="product__img default">
                        </a>
                    </div>
                    <div class="product__content">
                        <a href="details.html?productId=${relatedProduct.productId}"><h3 class="product__title">${relatedProduct.productName}</h3></a>
                        <div class="product__price flex">
                        <span class="new__price">€${relatedProduct.basePrice}</span>
                        <span class="old__price">€${(relatedProduct.basePrice * 1.2).toFixed(2)}</span>
                        </div>
                    </div>
                    `;
                    relatedProductsContainer.appendChild(productItem);
                });
                })
                .catch(error => console.error("Error fetching related products:", error));
          })
          .catch(error => {
            console.error("Error fetching product details:", error);
            alert('Product details could not be loaded');
          });
      });

      function addToCart(product) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];

        const existingProductIndex = cart.findIndex(item => item.product.productId === product.productId);
        
        if (existingProductIndex >= 0) {
          cart[existingProductIndex].quantity += parseInt(document.getElementById('quantity').value);
        } else {
          cart.push({
            product: {productId: product.productId},
            quantity: parseInt(document.getElementById('quantity').value),
            unitPrice: product.basePrice
          });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        window.location.href='cart.html'
      }

      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartCount = cart.reduce((total, item) => total + item.quantity, 0);
        document.getElementById('cart-count').textContent = cartCount;
      }          

      // Update the cart count when the page loads
      window.onload = updateCartCount;
    </script>
  </body>
</html>
